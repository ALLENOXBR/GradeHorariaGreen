<!DOCTYPE html>
<html lang="pt-br" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Escolar Premium - E.E. Prof. Juvenília</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Biblioteca para gerar PDF como imagem -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#14B8A6', // Verde Turquesa (Teal-500)
                        accent: '#0F766E',  // Teal-700 para contraste
                        darkBg: '#0F172A',
                        darkCard: '#1E293B'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            scroll-behavior: smooth;
        }

        .custom-scroll::-webkit-scrollbar { height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #14B8A6; border-radius: 10px; }

        /* REGRAS DE VISIBILIDADE */
        .mobile-grid { display: block; }
        .desktop-table { display: none; }

        @media (min-width: 1025px) {
            .mobile-grid { display: none; }
            .desktop-table { display: table; }
        }

        /* CORREÇÃO PARA O PDF - CENTRALIZAÇÃO E CORTE */
        .is-generating-pdf .mobile-grid { display: none !important; }
        .is-generating-pdf .desktop-table { display: table !important; width: 1050px !important; margin: 0 !important; }
        .is-generating-pdf #exportArea { 
            width: 1050px !important; 
            margin: 0 !important; 
            padding: 0 !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            transform: none !important;
            position: relative !important;
            left: 0 !important;
            top: 0 !important;
        }
        .is-generating-pdf #mainContainer { padding: 0 !important; margin: 0 !important; max-width: none !important; }

        .editable-input {
            background: transparent;
            border: none;
            width: 100%;
            text-align: inherit;
            color: inherit;
            transition: all 0.2s;
            cursor: default;
        }

        textarea.editable-input {
            resize: none;
            overflow: hidden;
            display: block;
            line-height: 1.2;
        }
        
        .edit-mode .editable-input {
            background-color: rgba(20, 184, 166, 0.1);
            box-shadow: inset 0 -1px 0 rgba(20, 184, 166, 0.5);
            cursor: text;
        }

        #pdfLoader {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            font-weight: 800;
            backdrop-blur: 5px;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-darkBg text-slate-900 dark:text-slate-100 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Loader de PDF -->
    <div id="pdfLoader">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent mb-4"></div>
        <p class="text-lg text-teal-400">Gerando foto em Verde Turquesa...</p>
        <p class="text-sm font-normal opacity-70 mt-2">Formatando página única para salvamento.</p>
    </div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-[100] bg-white/90 dark:bg-darkCard/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 no-print w-full">
        <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-primary p-1.5 rounded-lg shadow-md shadow-teal-500/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                </div>
                <span class="font-extrabold text-sm sm:text-base tracking-tight">Grade<span class="text-primary dark:text-teal-400">Master</span></span>
            </div>

            <div class="flex items-center gap-2">
                <button id="themeToggle" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" title="Alternar Tema">
                    <svg id="sunIcon" class="hidden dark:block w-4 h-4 text-teal-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                    <svg id="moonIcon" class="block dark:hidden w-4 h-4 text-slate-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                </button>

                <button id="toggleEdit" class="flex items-center gap-1 px-3 py-1.5 rounded-lg font-bold text-xs bg-slate-100 dark:bg-slate-800 hover:bg-primary hover:text-white transition-all">
                    <span id="editText">Editar</span>
                </button>

                <button onclick="generatePDF()" class="px-4 py-1.5 bg-primary text-white rounded-lg font-black text-xs shadow-lg shadow-teal-500/20 active:scale-95 transition-all">
                    SALVAR PDF
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Wrapper -->
    <div class="flex-1 w-full py-4 sm:py-8 px-2 sm:px-4 flex flex-col items-center">
        <main id="mainContainer" class="w-full max-w-[1100px]">
            <div id="exportArea" class="bg-white dark:bg-darkCard rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700 print-container">
                
                <!-- Header -->
                <header class="p-5 md:p-8 border-b-4 border-primary bg-slate-50/50 dark:bg-slate-800/30 flex flex-col md:flex-row gap-5 md:gap-8 items-start md:items-center">
                    <div class="w-16 h-16 md:w-24 md:h-24 bg-primary rounded-2xl flex items-center justify-center shadow-lg shadow-teal-500/20 shrink-0 mx-auto md:mx-0 text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 md:w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5Z"/><path d="M8 7h6"/><path d="M8 11h8"/></svg>
                    </div>
                    
                    <div class="flex-1 text-center md:text-left w-full">
                        <h2 class="text-lg md:text-2xl font-black text-slate-900 dark:text-white mb-4 leading-tight">
                            <textarea class="editable-input uppercase tracking-tight w-full" data-key="schoolName" readonly oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'">ESCOLA ESTADUAL PROFESSORA JUVENÍLIA FERREIRA DOS SANTOS</textarea>
                        </h2>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-[10px] md:text-xs font-bold uppercase text-slate-500 dark:text-slate-400">
                            <div class="flex items-center gap-2 border-l-4 border-primary pl-2 bg-white dark:bg-slate-900/40 p-1.5 rounded shadow-sm">
                                <span class="shrink-0 opacity-70">DIRETOR:</span>
                                <input class="editable-input text-slate-900 dark:text-slate-200" data-key="staff1" value="LUIZ ANTÔNIO DE SOUZA" readonly>
                            </div>
                            <div class="flex items-center gap-2 border-l-4 border-primary pl-2 bg-white dark:bg-slate-900/40 p-1.5 rounded shadow-sm">
                                <span class="shrink-0 opacity-70">VICE:</span>
                                <input class="editable-input text-slate-900 dark:text-slate-200" data-key="staff2" value="TÚLIO SIQUEIRA DE OLIVEIRA" readonly>
                            </div>
                            <div class="flex items-center gap-2 border-l-4 border-primary pl-2 bg-white dark:bg-slate-900/40 p-1.5 rounded shadow-sm">
                                <span class="shrink-0 opacity-70">SUPERVISÃO:</span>
                                <input class="editable-input text-slate-900 dark:text-slate-200" data-key="staff3" value="JACQUELINE CATALUNHA" readonly>
                            </div>
                            <div class="flex items-center gap-2 border-l-4 border-primary pl-3 bg-white dark:bg-slate-900/40 p-1.5 rounded shadow-sm">
                                <span class="shrink-0 opacity-70">COORD:</span>
                                <input class="editable-input text-slate-900 dark:text-slate-200" data-key="staff4" value="GIULIANA MARTINS FERREIRA" readonly>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Info Bar -->
                <div class="px-5 py-3 bg-slate-100 dark:bg-slate-900/50 flex flex-wrap justify-between items-center gap-3 border-b border-slate-200 dark:border-slate-700">
                    <div class="flex gap-4 sm:gap-8 font-black text-[10px] md:text-xs uppercase text-teal-600 dark:text-teal-400">
                        <div class="flex items-center gap-2">
                            <span class="opacity-40 text-[8px]">TURNO:</span>
                            <input class="editable-input w-20 sm:w-24" data-key="shift" value="NOTURNO" readonly>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="opacity-40 text-[8px]">TURMA:</span>
                            <input class="editable-input w-20 sm:w-24" data-key="classLevel" value="3º EJA" readonly>
                        </div>
                    </div>
                    <div class="text-[10px] font-bold bg-white dark:bg-slate-800 px-3 py-1 rounded-full shadow-sm border border-slate-200 dark:border-slate-700 flex items-center gap-2">
                        <span class="opacity-50">INÍCIO:</span>
                        <input class="editable-input w-12 text-center font-black" data-key="t1" value="19:00" readonly>
                    </div>
                </div>

                <!-- Lista Mobile -->
                <div id="mobileSchedule" class="mobile-grid p-4 space-y-6 bg-slate-50 dark:bg-slate-900/20">
                    <!-- Preenchido via JS -->
                </div>

                <!-- Tabela Desktop -->
                <div class="desktop-table w-full overflow-x-auto custom-scroll">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-slate-100 dark:bg-slate-800 text-[11px] font-black uppercase tracking-widest text-slate-600 dark:text-slate-300">
                                <th class="p-3 border-r border-slate-200 dark:border-slate-700 w-28">Horário</th>
                                <th class="p-3 border-r border-slate-200 dark:border-slate-700">Segunda</th>
                                <th class="p-3 border-r border-slate-200 dark:border-slate-700">Terça</th>
                                <th class="p-3 border-r border-slate-200 dark:border-slate-700">Quarta</th>
                                <th class="p-3 border-r border-slate-200 dark:border-slate-700">Quinta</th>
                                <th class="p-3">Sexta</th>
                            </tr>
                        </thead>
                        <tbody id="desktopBody">
                            <!-- Preenchido via JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Footer -->
                <footer class="p-6 bg-slate-50 dark:bg-slate-900/40 border-t border-slate-200 dark:border-slate-700 text-center md:text-left">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                        <div class="flex flex-col items-center md:items-start">
                            <span class="text-[9px] font-black uppercase tracking-[0.3em] text-slate-400 mb-1">Digital School System</span>
                            <span class="text-xs md:text-sm font-bold uppercase">2026 • <span class="text-primary dark:text-teal-400 font-black">E.E. Professora Juvenília</span></span>
                        </div>
                        
                        <div class="flex flex-col items-center">
                            <div class="w-48 h-px bg-slate-300 dark:bg-slate-600 mb-2"></div>
                            <span class="text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest opacity-70 text-teal-600 dark:text-teal-500">Secretaria de Educação</span>
                        </div>
                    </div>
                </footer>
            </div>
        </main>
    </div>

    <script>
        const days = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta'];
        const scheduleData = [
            { label: '19:00', type: 'special', content: '••••••••••••••••••••••••••••••••••••' },
            { label: '1º Horário', items: [['Soluções Mat.', 'Vilson'], ['Português', 'Elza'], ['Intervenção Cidadã', 'Marcelo'], ['Química', 'Pollyana'], ['Biologia', 'Ranner']] },
            { label: '2º Horário', items: [['História', 'Geane'], ['Arte', 'Cristino'], ['Português', 'Elza'], ['Matemática', 'Crislaine'], ['Física', 'Daniel']] },
            { label: 'Recreio', type: 'break', content: 'Intervalo de Convivência' },
            { label: '3º Horário', items: [['Matemática', 'Crislaine'], ['Geografia', 'Marcelo'], ['Sociologia', 'Fabiola'], ['Português', 'Elza'], ['Matemática', 'Crislaine']] },
            { label: '4º Horário', items: [['Português', 'Elza'], ['Matemática', 'Crislaine'], ['Filosofia', 'José'], ['Biologia', 'Ranner'], ['Inglês', 'Ana Paula']] }
        ];

        async function generatePDF() {
            const loader = document.getElementById('pdfLoader');
            const element = document.getElementById('exportArea');
            const schoolName = document.querySelector('[data-key="schoolName"]').value || 'Grade';
            
            loader.style.display = 'flex';

            document.body.classList.add('is-generating-pdf');

            const opt = {
                margin: [10, 10, 10, 10],
                filename: `Grade_${schoolName.substring(0,25).replace(/ /g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true,
                    logging: false,
                    letterRendering: true,
                    scrollX: 0,
                    scrollY: 0,
                    x: 0,
                    y: 0,
                    windowWidth: 1100
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };

            try {
                await new Promise(r => setTimeout(r, 400));
                await html2pdf().set(opt).from(element).save();
            } catch (err) {
                console.error('Erro ao gerar PDF:', err);
            } finally {
                document.body.classList.remove('is-generating-pdf');
                loader.style.display = 'none';
                autoResizeTitle();
            }
        }

        function autoResizeTitle() {
            const tx = document.querySelector('textarea[data-key="schoolName"]');
            if (tx) {
                tx.style.height = 'auto';
                tx.style.height = tx.scrollHeight + 'px';
            }
        }

        function renderSchedule() {
            const desktopBody = document.getElementById('desktopBody');
            const mobileSchedule = document.getElementById('mobileSchedule');
            
            let desktopHTML = '';
            let mobileHTMLByDay = days.map(day => ({ day, content: '' }));

            scheduleData.forEach((row, rIdx) => {
                if (row.type === 'special') {
                    desktopHTML += `
                        <tr class="border-b border-slate-100 dark:border-slate-800">
                            <td class="p-2 bg-slate-50/50 dark:bg-slate-800/20 text-center font-black text-[10px] border-r border-slate-200 dark:border-slate-700">
                                <input class="editable-input text-center" data-key="t1" value="${row.label}" readonly>
                            </td>
                            <td colspan="5" class="p-2 text-center font-black tracking-[1.5em] text-slate-200 dark:text-slate-700 opacity-30 text-[9px]">${row.content}</td>
                        </tr>
                    `;
                } else if (row.type === 'break') {
                    desktopHTML += `
                        <tr class="bg-primary border-y border-teal-600/30">
                            <td class="p-3 text-center font-black uppercase text-white border-r border-teal-600/30 text-[10px]">${row.label}</td>
                            <td colspan="5" class="p-3 text-center text-lg font-black uppercase tracking-[0.5em] text-white italic opacity-80">${row.content}</td>
                        </tr>
                    `;
                    mobileHTMLByDay.forEach(d => {
                        d.content += `
                            <div class="bg-teal-500/10 border-l-4 border-primary p-2 my-4 rounded-r shadow-sm text-center">
                                <div class="text-[8px] font-black text-primary uppercase tracking-widest mb-0.5">${row.label}</div>
                                <div class="text-[11px] font-black text-slate-800 dark:text-slate-200 italic">${row.content}</div>
                            </div>
                        `;
                    });
                } else {
                    let tdCells = `<td class="p-3 border-r border-slate-200 dark:border-slate-700 text-center font-black text-[9px] bg-slate-50/50 dark:bg-slate-800/20 uppercase tracking-tighter">
                        <input class="editable-input text-center" data-key="rowLabel${rIdx}" value="${row.label}" readonly>
                    </td>`;
                    
                    row.items.forEach((cell, cIdx) => {
                        const keyS = `r${rIdx}c${cIdx}s`;
                        const keyP = `r${rIdx}c${cIdx}p`;
                        
                        tdCells += `
                            <td class="p-2 border-r border-slate-200 dark:border-slate-700 text-center hover:bg-teal-50 dark:hover:bg-teal-900/10 transition-all group">
                                <input class="editable-input font-black text-[11px] sm:text-xs block mb-0.5" data-key="${keyS}" value="${cell[0]}" readonly>
                                <div class="text-[8px] sm:text-[9px] font-bold text-primary dark:text-teal-400 uppercase flex items-center justify-center gap-1 bg-teal-500/5 py-0.5 rounded">
                                    <input class="editable-input w-auto text-center" data-key="${keyP}" value="${cell[1]}" readonly>
                                </div>
                            </td>
                        `;

                        mobileHTMLByDay[cIdx].content += `
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 mb-3 shadow-md active:scale-[0.98] transition-transform">
                                <div class="text-[9px] font-black text-slate-400 w-14 leading-tight uppercase border-r border-slate-100 dark:border-slate-700 pr-2 shrink-0">${row.label}</div>
                                <div class="flex-1">
                                    <input class="editable-input font-black text-sm block mb-0.5" data-key="${keyS}" value="${cell[0]}" readonly>
                                    <div class="text-[10px] text-primary dark:text-teal-400 font-bold uppercase flex items-center gap-1">
                                        <span class="opacity-40 font-bold">PROF:</span>
                                        <input class="editable-input w-auto" data-key="${keyP}" value="${cell[1]}" readonly>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    desktopHTML += `<tr class="border-b border-slate-100 dark:border-slate-800">${tdCells}</tr>`;
                }
            });

            desktopBody.innerHTML = desktopHTML;
            
            let mobileFinalHTML = '';
            mobileHTMLByDay.forEach(dayObj => {
                mobileFinalHTML += `
                    <section class="max-w-md mx-auto w-full">
                        <h3 class="flex items-center gap-3 mb-3">
                            <span class="px-3 py-1 bg-primary text-white font-black uppercase tracking-widest text-[9px] rounded-lg shadow-md shadow-teal-500/20">${dayObj.day}</span>
                            <div class="flex-1 h-px bg-slate-200 dark:bg-slate-700"></div>
                        </h3>
                        ${dayObj.content}
                    </section>
                `;
            });
            mobileSchedule.innerHTML = mobileFinalHTML;

            attachInputEvents();
            loadData();
            autoResizeTitle();
        }

        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        const toggleBtn = document.getElementById('toggleEdit');
        const editText = document.getElementById('editText');
        const mainContainer = document.getElementById('mainContainer');
        let isEditing = false;

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
        });

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
        }

        function saveData() {
            const data = {};
            document.querySelectorAll('.editable-input').forEach(input => {
                const key = input.getAttribute('data-key');
                if(key) data[key] = input.value;
            });
            localStorage.setItem('grade_v11_teal_pdf', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem('grade_v11_teal_pdf');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.querySelectorAll('.editable-input').forEach(input => {
                    const key = input.getAttribute('data-key');
                    if (data[key]) {
                        input.value = data[key];
                        document.querySelectorAll(`[data-key="${key}"]`).forEach(el => el.value = data[key]);
                    }
                });
            }
        }

        function attachInputEvents() {
            document.querySelectorAll('.editable-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const key = e.target.getAttribute('data-key');
                    const value = e.target.value;
                    document.querySelectorAll(`[data-key="${key}"]`).forEach(el => {
                        if (el !== e.target) el.value = value;
                    });
                    saveData();
                });
            });
        }

        toggleBtn.addEventListener('click', () => {
            isEditing = !isEditing;
            mainContainer.classList.toggle('edit-mode');
            document.querySelectorAll('.editable-input').forEach(input => input.readOnly = !isEditing);
            editText.textContent = isEditing ? "Salvar" : "Editar";
            toggleBtn.classList.toggle('bg-primary', isEditing);
            if (!isEditing) saveData();
            autoResizeTitle();
        });

        window.addEventListener('resize', autoResizeTitle);
        renderSchedule();
    </script>
</body>
</html>
